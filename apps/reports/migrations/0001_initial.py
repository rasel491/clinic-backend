# Generated by Django 6.0.1 on 2026-01-17 14:09

import django.core.validators
import django.db.models.deletion
import django.utils.timezone
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('clinics', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Dashboard',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('name', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True)),
                ('dashboard_type', models.CharField(choices=[('PERSONAL', 'Personal Dashboard'), ('BRANCH', 'Branch Dashboard'), ('DEPARTMENT', 'Department Dashboard'), ('MANAGEMENT', 'Management Dashboard')], default='PERSONAL', max_length=20)),
                ('layout_config', models.JSONField(blank=True, default=dict, help_text='Dashboard layout configuration')),
                ('is_public', models.BooleanField(default=False)),
                ('icon', models.CharField(blank=True, max_length=50)),
                ('color', models.CharField(blank=True, default='#3498db', max_length=20)),
                ('sort_order', models.PositiveIntegerField(default=0)),
                ('is_active', models.BooleanField(default=True)),
                ('is_default', models.BooleanField(default=False, help_text='Default dashboard for this type')),
                ('branch', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='clinics.branch')),
                ('created_by', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_%(class)s', to=settings.AUTH_USER_MODEL)),
                ('shared_with', models.ManyToManyField(blank=True, help_text='Users with access to this dashboard', related_name='shared_dashboards', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_%(class)s', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Dashboard',
                'verbose_name_plural': 'Dashboards',
                'ordering': ['sort_order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='GeneratedReport',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('report_number', models.CharField(max_length=50, unique=True)),
                ('parameters', models.JSONField(blank=True, default=dict, help_text='Parameters used for generating this report')),
                ('start_date', models.DateField(blank=True, null=True)),
                ('end_date', models.DateField(blank=True, null=True)),
                ('status', models.CharField(choices=[('PENDING', 'Pending'), ('PROCESSING', 'Processing'), ('COMPLETED', 'Completed'), ('FAILED', 'Failed'), ('CANCELLED', 'Cancelled')], default='PENDING', max_length=20)),
                ('error_message', models.TextField(blank=True)),
                ('stack_trace', models.TextField(blank=True)),
                ('generated_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('file_path', models.CharField(blank=True, max_length=500)),
                ('file_size', models.PositiveBigIntegerField(default=0)),
                ('download_count', models.PositiveIntegerField(default=0)),
                ('generation_duration', models.DurationField(blank=True, null=True)),
                ('row_count', models.PositiveIntegerField(default=0)),
                ('is_archived', models.BooleanField(default=False)),
                ('archive_reason', models.TextField(blank=True)),
                ('branch', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='clinics.branch')),
                ('created_by', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_%(class)s', to=settings.AUTH_USER_MODEL)),
                ('generated_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='generated_reports', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_%(class)s', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Generated Report',
                'verbose_name_plural': 'Generated Reports',
                'ordering': ['-generated_at'],
            },
        ),
        migrations.CreateModel(
            name='ReportCategory',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('name', models.CharField(max_length=100, unique=True)),
                ('code', models.CharField(max_length=50, unique=True)),
                ('description', models.TextField(blank=True)),
                ('icon', models.CharField(blank=True, help_text='Icon class name', max_length=50)),
                ('sort_order', models.PositiveIntegerField(default=0)),
                ('is_active', models.BooleanField(default=True)),
            ],
            options={
                'verbose_name': 'Report Category',
                'verbose_name_plural': 'Report Categories',
                'ordering': ['sort_order', 'name'],
                'indexes': [models.Index(fields=['code', 'is_active'], name='reports_rep_code_2fbeab_idx')],
            },
        ),
        migrations.CreateModel(
            name='ReportData',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('data_json', models.JSONField(blank=True, default=dict, help_text='JSON structure of report data')),
                ('summary', models.JSONField(blank=True, default=dict, help_text='Summary/aggregated data')),
                ('data_version', models.CharField(default='1.0', max_length=20)),
                ('compressed', models.BooleanField(default=False)),
                ('generated_report', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='data', to='reports.generatedreport')),
            ],
            options={
                'verbose_name': 'Report Data',
                'verbose_name_plural': 'Report Data',
            },
        ),
        migrations.CreateModel(
            name='ReportExport',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('export_number', models.CharField(max_length=50, unique=True)),
                ('export_format', models.CharField(choices=[('PDF', 'PDF'), ('EXCEL', 'Excel'), ('CSV', 'CSV'), ('JSON', 'JSON')], max_length=10)),
                ('file_path', models.CharField(max_length=500)),
                ('file_size', models.PositiveBigIntegerField()),
                ('include_charts', models.BooleanField(default=True)),
                ('include_summary', models.BooleanField(default=True)),
                ('include_details', models.BooleanField(default=True)),
                ('exported_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('export_duration', models.DurationField(blank=True, null=True)),
                ('branch', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='clinics.branch')),
                ('exported_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='report_exports', to=settings.AUTH_USER_MODEL)),
                ('generated_report', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exports', to='reports.generatedreport')),
            ],
            options={
                'verbose_name': 'Report Export',
                'verbose_name_plural': 'Report Exports',
                'ordering': ['-exported_at'],
            },
        ),
        migrations.CreateModel(
            name='ReportTemplate',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('name', models.CharField(max_length=200)),
                ('code', models.CharField(max_length=100, unique=True)),
                ('description', models.TextField(blank=True)),
                ('report_type', models.CharField(choices=[('FINANCIAL', 'Financial Reports'), ('CLINICAL', 'Clinical Reports'), ('OPERATIONAL', 'Operational Reports'), ('INVENTORY', 'Inventory Reports'), ('CUSTOM', 'Custom Reports')], max_length=20)),
                ('query_sql', models.TextField(blank=True, help_text='SQL query for the report')),
                ('query_parameters', models.JSONField(blank=True, default=dict, help_text='JSON schema for report parameters')),
                ('output_format', models.CharField(choices=[('HTML', 'HTML'), ('PDF', 'PDF'), ('EXCEL', 'Excel'), ('CSV', 'CSV'), ('JSON', 'JSON')], default='HTML', max_length=10)),
                ('is_scheduled', models.BooleanField(default=False)),
                ('frequency', models.CharField(choices=[('DAILY', 'Daily'), ('WEEKLY', 'Weekly'), ('MONTHLY', 'Monthly'), ('QUARTERLY', 'Quarterly'), ('YEARLY', 'Yearly'), ('ON_DEMAND', 'On Demand')], default='ON_DEMAND', max_length=20)),
                ('schedule_time', models.TimeField(blank=True, help_text='Time to run scheduled reports', null=True)),
                ('schedule_day', models.PositiveIntegerField(blank=True, help_text='Day of month for monthly reports', null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(31)])),
                ('requires_permission', models.BooleanField(default=True)),
                ('allowed_roles', models.JSONField(blank=True, default=list, help_text='List of role codes allowed to view this report')),
                ('icon', models.CharField(blank=True, max_length=50)),
                ('sort_order', models.PositiveIntegerField(default=0)),
                ('is_active', models.BooleanField(default=True)),
                ('html_template', models.TextField(blank=True, help_text='HTML template for rendering')),
                ('excel_template', models.FileField(blank=True, null=True, upload_to='report_templates/excel/')),
                ('last_run_at', models.DateTimeField(blank=True, null=True)),
                ('branch', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='clinics.branch')),
                ('category', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='templates', to='reports.reportcategory')),
                ('created_by', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_%(class)s', to=settings.AUTH_USER_MODEL)),
                ('last_run_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='last_run_reports', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_%(class)s', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Report Template',
                'verbose_name_plural': 'Report Templates',
                'ordering': ['sort_order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='ReportSchedule',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('schedule_number', models.CharField(max_length=50, unique=True)),
                ('frequency', models.CharField(choices=[('DAILY', 'Daily'), ('WEEKLY', 'Weekly'), ('MONTHLY', 'Monthly'), ('QUARTERLY', 'Quarterly'), ('YEARLY', 'Yearly'), ('ON_DEMAND', 'On Demand')], max_length=20)),
                ('schedule_time', models.TimeField(blank=True, null=True)),
                ('schedule_day', models.PositiveIntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(31)])),
                ('start_date', models.DateField()),
                ('end_date', models.DateField(blank=True, null=True)),
                ('is_recurring', models.BooleanField(default=True)),
                ('parameters', models.JSONField(blank=True, default=dict)),
                ('delivery_method', models.CharField(choices=[('EMAIL', 'Email'), ('DASHBOARD', 'Dashboard'), ('DOWNLOAD', 'Download Only'), ('ALL', 'Email & Dashboard')], default='EMAIL', max_length=20)),
                ('email_recipients', models.JSONField(blank=True, default=list, help_text='List of email addresses')),
                ('email_subject', models.CharField(blank=True, max_length=200)),
                ('email_body', models.TextField(blank=True)),
                ('status', models.CharField(choices=[('ACTIVE', 'Active'), ('PAUSED', 'Paused'), ('COMPLETED', 'Completed'), ('CANCELLED', 'Cancelled')], default='ACTIVE', max_length=20)),
                ('next_run_at', models.DateTimeField(blank=True, null=True)),
                ('last_run_at', models.DateTimeField(blank=True, null=True)),
                ('last_run_status', models.CharField(blank=True, max_length=20)),
                ('total_runs', models.PositiveIntegerField(default=0)),
                ('successful_runs', models.PositiveIntegerField(default=0)),
                ('failed_runs', models.PositiveIntegerField(default=0)),
                ('branch', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='clinics.branch')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='scheduled_reports', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_%(class)s', to=settings.AUTH_USER_MODEL)),
                ('template', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='schedules', to='reports.reporttemplate')),
            ],
            options={
                'verbose_name': 'Report Schedule',
                'verbose_name_plural': 'Report Schedules',
                'ordering': ['next_run_at'],
            },
        ),
        migrations.CreateModel(
            name='ReportFavorite',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('added_at', models.DateTimeField(auto_now_add=True)),
                ('notes', models.TextField(blank=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='favorite_reports', to=settings.AUTH_USER_MODEL)),
                ('report_template', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='favorited_by', to='reports.reporttemplate')),
            ],
            options={
                'verbose_name': 'Report Favorite',
                'verbose_name_plural': 'Report Favorites',
                'ordering': ['-added_at'],
            },
        ),
        migrations.AddField(
            model_name='generatedreport',
            name='template',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='generated_reports', to='reports.reporttemplate'),
        ),
        migrations.CreateModel(
            name='DashboardWidget',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('name', models.CharField(max_length=200)),
                ('widget_type', models.CharField(choices=[('CHART', 'Chart'), ('TABLE', 'Data Table'), ('METRIC', 'Metric Card'), ('KPI', 'KPI Card'), ('LIST', 'List'), ('CALENDAR', 'Calendar'), ('CUSTOM', 'Custom Widget')], max_length=20)),
                ('config', models.JSONField(blank=True, default=dict, help_text='Widget configuration (chart type, colors, etc.)')),
                ('data_source_type', models.CharField(choices=[('REPORT', 'Report Template'), ('QUERY', 'SQL Query'), ('API', 'API Endpoint'), ('STATIC', 'Static Data')], default='REPORT', max_length=20)),
                ('query_sql', models.TextField(blank=True)),
                ('api_endpoint', models.CharField(blank=True, max_length=500)),
                ('static_data', models.JSONField(blank=True, default=dict)),
                ('width', models.PositiveIntegerField(default=4, help_text='Grid width (1-12)')),
                ('height', models.PositiveIntegerField(default=300, help_text='Height in pixels')),
                ('position_x', models.PositiveIntegerField(default=0)),
                ('position_y', models.PositiveIntegerField(default=0)),
                ('refresh_interval', models.PositiveIntegerField(default=0, help_text='Refresh interval in seconds (0 = manual)')),
                ('last_refreshed_at', models.DateTimeField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('branch', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='clinics.branch')),
                ('dashboard', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='widgets', to='reports.dashboard')),
                ('report_template', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='widgets', to='reports.reporttemplate')),
            ],
            options={
                'verbose_name': 'Dashboard Widget',
                'verbose_name_plural': 'Dashboard Widgets',
                'ordering': ['position_y', 'position_x'],
            },
        ),
        migrations.AddIndex(
            model_name='dashboard',
            index=models.Index(fields=['dashboard_type', 'is_active'], name='reports_das_dashboa_fb894a_idx'),
        ),
        migrations.AddIndex(
            model_name='dashboard',
            index=models.Index(fields=['is_default', 'branch'], name='reports_das_is_defa_664265_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='dashboard',
            unique_together={('branch', 'dashboard_type', 'is_default')},
        ),
        migrations.AddIndex(
            model_name='reportdata',
            index=models.Index(fields=['generated_report'], name='reports_rep_generat_93473a_idx'),
        ),
        migrations.AddIndex(
            model_name='reportexport',
            index=models.Index(fields=['export_number'], name='reports_rep_export__b0fb63_idx'),
        ),
        migrations.AddIndex(
            model_name='reportexport',
            index=models.Index(fields=['generated_report', 'export_format'], name='reports_rep_generat_296a7c_idx'),
        ),
        migrations.AddIndex(
            model_name='reportexport',
            index=models.Index(fields=['exported_by', 'exported_at'], name='reports_rep_exporte_079a6e_idx'),
        ),
        migrations.AddIndex(
            model_name='reporttemplate',
            index=models.Index(fields=['code', 'is_active'], name='reports_rep_code_0fc840_idx'),
        ),
        migrations.AddIndex(
            model_name='reporttemplate',
            index=models.Index(fields=['report_type', 'is_active'], name='reports_rep_report__11a031_idx'),
        ),
        migrations.AddIndex(
            model_name='reporttemplate',
            index=models.Index(fields=['is_scheduled', 'frequency'], name='reports_rep_is_sche_eb4853_idx'),
        ),
        migrations.AddIndex(
            model_name='reportschedule',
            index=models.Index(fields=['schedule_number'], name='reports_rep_schedul_83dac3_idx'),
        ),
        migrations.AddIndex(
            model_name='reportschedule',
            index=models.Index(fields=['template', 'status'], name='reports_rep_templat_a9968b_idx'),
        ),
        migrations.AddIndex(
            model_name='reportschedule',
            index=models.Index(fields=['status', 'next_run_at'], name='reports_rep_status_ed66c7_idx'),
        ),
        migrations.AddIndex(
            model_name='reportschedule',
            index=models.Index(fields=['frequency', 'next_run_at'], name='reports_rep_frequen_d38daa_idx'),
        ),
        migrations.AddIndex(
            model_name='reportfavorite',
            index=models.Index(fields=['user', 'report_template'], name='reports_rep_user_id_369181_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='reportfavorite',
            unique_together={('user', 'report_template')},
        ),
        migrations.AddIndex(
            model_name='generatedreport',
            index=models.Index(fields=['report_number'], name='reports_gen_report__e3e51c_idx'),
        ),
        migrations.AddIndex(
            model_name='generatedreport',
            index=models.Index(fields=['template', 'status'], name='reports_gen_templat_272848_idx'),
        ),
        migrations.AddIndex(
            model_name='generatedreport',
            index=models.Index(fields=['start_date', 'end_date'], name='reports_gen_start_d_8a6364_idx'),
        ),
        migrations.AddIndex(
            model_name='generatedreport',
            index=models.Index(fields=['generated_by', 'generated_at'], name='reports_gen_generat_e399e1_idx'),
        ),
        migrations.AddIndex(
            model_name='generatedreport',
            index=models.Index(fields=['status', 'generated_at'], name='reports_gen_status_4d1741_idx'),
        ),
        migrations.AddIndex(
            model_name='dashboardwidget',
            index=models.Index(fields=['dashboard', 'is_active'], name='reports_das_dashboa_9e0984_idx'),
        ),
        migrations.AddIndex(
            model_name='dashboardwidget',
            index=models.Index(fields=['widget_type', 'is_active'], name='reports_das_widget__99a9b5_idx'),
        ),
    ]
