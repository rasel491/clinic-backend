# Generated by Django 5.2.1 on 2026-01-17 13:51

import django.core.validators
import django.db.models.deletion
import django.utils.timezone
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('billing', '0001_initial'),
        ('clinics', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='EodLock',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('lock_number', models.CharField(help_text='Auto-generated lock number: EOD-YYYYMMDD-XXX', max_length=20, unique=True)),
                ('lock_date', models.DateField()),
                ('total_invoices', models.PositiveIntegerField(default=0)),
                ('total_invoice_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('total_payments', models.PositiveIntegerField(default=0)),
                ('total_payment_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('total_refunds', models.PositiveIntegerField(default=0)),
                ('total_refund_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('total_cash_collected', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('total_cash_refunded', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('net_cash_position', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('opening_cash', models.DecimalField(decimal_places=2, help_text='Cash in drawer at start of day', max_digits=12)),
                ('expected_cash', models.DecimalField(decimal_places=2, help_text='Expected cash based on transactions', max_digits=12)),
                ('actual_cash', models.DecimalField(blank=True, decimal_places=2, help_text='Actual cash counted during EOD', max_digits=12, null=True)),
                ('cash_difference', models.DecimalField(blank=True, decimal_places=2, help_text='Difference between expected and actual', max_digits=12, null=True)),
                ('card_collections', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('upi_collections', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('bank_transfers', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('insurance_collections', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('cheque_collections', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('status', models.CharField(choices=[('PREPARED', 'Prepared'), ('REVIEWED', 'Reviewed'), ('LOCKED', 'Locked'), ('REVERSED', 'Reversed')], default='PREPARED', max_length=20)),
                ('prepared_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('reviewed_at', models.DateTimeField(blank=True, null=True)),
                ('review_notes', models.TextField(blank=True)),
                ('locked_at', models.DateTimeField(blank=True, null=True)),
                ('reversed_at', models.DateTimeField(blank=True, null=True)),
                ('reversal_reason', models.TextField(blank=True)),
                ('cash_verified', models.BooleanField(default=False)),
                ('cash_verified_at', models.DateTimeField(blank=True, null=True)),
                ('digital_payments_verified', models.BooleanField(default=False)),
                ('digital_verified_at', models.DateTimeField(blank=True, null=True)),
                ('invoices_verified', models.BooleanField(default=False)),
                ('invoices_verified_at', models.DateTimeField(blank=True, null=True)),
                ('has_discrepancies', models.BooleanField(default=False)),
                ('discrepancy_notes', models.TextField(blank=True)),
                ('discrepancy_resolved', models.BooleanField(default=False)),
                ('discrepancy_resolved_at', models.DateTimeField(blank=True, null=True)),
                ('resolution_notes', models.TextField(blank=True)),
                ('notes', models.TextField(blank=True)),
            ],
            options={
                'verbose_name': 'EOD Lock',
                'verbose_name_plural': 'EOD Locks',
                'ordering': ['-lock_date', 'branch'],
            },
        ),
        migrations.CreateModel(
            name='CashReconciliation',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('reconciliation_number', models.CharField(max_length=20, unique=True)),
                ('reconciliation_date', models.DateField()),
                ('reconciliation_type', models.CharField(choices=[('OPENING', 'Opening Cash'), ('MID_DAY', 'Mid-Day Cash'), ('CLOSING', 'Closing Cash'), ('SURPRISE', 'Surprise Check')], max_length=20)),
                ('declared_cash', models.DecimalField(decimal_places=2, help_text='Cash declared by cashier', max_digits=12)),
                ('counted_cash', models.DecimalField(blank=True, decimal_places=2, help_text='Cash counted by supervisor', max_digits=12, null=True)),
                ('difference', models.DecimalField(blank=True, decimal_places=2, help_text='Difference between declared and counted', max_digits=12, null=True)),
                ('denomination_breakdown', models.JSONField(default=dict, help_text='JSON breakdown of cash by denomination')),
                ('supervised_at', models.DateTimeField(blank=True, null=True)),
                ('verified', models.BooleanField(default=False)),
                ('verification_notes', models.TextField(blank=True)),
                ('cash_count_image', models.ImageField(blank=True, help_text='Photo of cash count if surprise check', null=True, upload_to='cash_reconciliations/%Y/%m/%d/')),
                ('signature_image', models.ImageField(blank=True, help_text="Cashier's signature", null=True, upload_to='signatures/%Y/%m/%d/')),
                ('notes', models.TextField(blank=True)),
                ('branch', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='clinics.branch')),
                ('cashier', models.ForeignKey(help_text='Cashier responsible for the cash', on_delete=django.db.models.deletion.PROTECT, related_name='cash_reconciliations', to=settings.AUTH_USER_MODEL)),
                ('counter', models.ForeignKey(help_text='Counter where cash is stored', on_delete=django.db.models.deletion.PROTECT, related_name='cash_reconciliations', to='clinics.counter')),
                ('created_by', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_%(class)s', to=settings.AUTH_USER_MODEL)),
                ('supervisor', models.ForeignKey(blank=True, help_text='Supervisor who verified the cash', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='supervised_reconciliations', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_%(class)s', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Cash Reconciliation',
                'verbose_name_plural': 'Cash Reconciliations',
                'ordering': ['-reconciliation_date', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DailySummary',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('summary_number', models.CharField(max_length=20, unique=True)),
                ('summary_date', models.DateField()),
                ('summary_type', models.CharField(choices=[('MORNING', 'Morning Summary'), ('AFTERNOON', 'Afternoon Summary'), ('EVENING', 'Evening Summary'), ('EOD', 'End of Day Summary'), ('CUSTOM', 'Custom Summary')], max_length=20)),
                ('custom_name', models.CharField(blank=True, max_length=100)),
                ('period_start', models.DateTimeField()),
                ('period_end', models.DateTimeField()),
                ('invoices_count', models.PositiveIntegerField(default=0)),
                ('invoices_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('payments_count', models.PositiveIntegerField(default=0)),
                ('payments_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('refunds_count', models.PositiveIntegerField(default=0)),
                ('refunds_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('appointments_total', models.PositiveIntegerField(default=0)),
                ('appointments_completed', models.PositiveIntegerField(default=0)),
                ('appointments_cancelled', models.PositiveIntegerField(default=0)),
                ('appointments_no_show', models.PositiveIntegerField(default=0)),
                ('new_patients', models.PositiveIntegerField(default=0)),
                ('returning_patients', models.PositiveIntegerField(default=0)),
                ('doctors_active', models.PositiveIntegerField(default=0)),
                ('doctor_utilization', models.DecimalField(decimal_places=2, default=0, help_text='Percentage of doctor time utilized', max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('invoice_details', models.JSONField(blank=True, default=dict)),
                ('payment_details', models.JSONField(blank=True, default=dict)),
                ('appointment_details', models.JSONField(blank=True, default=dict)),
                ('generated_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('notes', models.TextField(blank=True)),
                ('branch', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='clinics.branch')),
                ('created_by', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_%(class)s', to=settings.AUTH_USER_MODEL)),
                ('generated_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='generated_summaries', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_%(class)s', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Daily Summary',
                'verbose_name_plural': 'Daily Summaries',
                'ordering': ['-summary_date', '-period_end'],
            },
        ),
        migrations.CreateModel(
            name='EodException',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('exception_number', models.CharField(max_length=20, unique=True)),
                ('exception_date', models.DateField()),
                ('exception_type', models.CharField(choices=[('CASH_DISCREPANCY', 'Cash Discrepancy'), ('MISSING_RECEIPT', 'Missing Receipt'), ('UNACCOUNTED_PAYMENT', 'Unaccounted Payment'), ('DATA_MISMATCH', 'Data Mismatch'), ('SYSTEM_ERROR', 'System Error'), ('OTHER', 'Other')], max_length=20)),
                ('severity', models.CharField(choices=[('LOW', 'Low'), ('MEDIUM', 'Medium'), ('HIGH', 'High'), ('CRITICAL', 'Critical')], default='MEDIUM', max_length=20)),
                ('title', models.CharField(max_length=200)),
                ('description', models.TextField()),
                ('amount_involved', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('status', models.CharField(choices=[('OPEN', 'Open'), ('IN_PROGRESS', 'In Progress'), ('RESOLVED', 'Resolved'), ('CANCELLED', 'Cancelled')], default='OPEN', max_length=20)),
                ('assigned_at', models.DateTimeField(blank=True, null=True)),
                ('resolved_at', models.DateTimeField(blank=True, null=True)),
                ('resolution_notes', models.TextField(blank=True)),
                ('resolution_action', models.CharField(blank=True, max_length=200)),
                ('attachment', models.FileField(blank=True, null=True, upload_to='eod_exceptions/%Y/%m/%d/')),
                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_exceptions', to=settings.AUTH_USER_MODEL)),
                ('branch', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='clinics.branch')),
                ('created_by', models.ForeignKey(editable=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_%(class)s', to=settings.AUTH_USER_MODEL)),
                ('related_invoice', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='eod_exceptions', to='billing.invoice')),
            ],
            options={
                'verbose_name': 'EOD Exception',
                'verbose_name_plural': 'EOD Exceptions',
                'ordering': ['-exception_date', '-created_at'],
            },
        ),
    ]
